<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PizzaControl - Usuario</title>
        <link rel="stylesheet" href="../assets/css/styles.css">

</head>
<body>
    <div class="container">
        <h1>Menú de Pizzas</h1>
        <table id="menu">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Tamaño</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Pizza Margarita</td>
                    <td>Queso mozzarella y tomate</td>
                    <td>
                        <select>
                            <option value="small" data-price="100">Pequeña</option>
                            <option value="medium" data-price="150">Mediana</option>
                            <option value="large" data-price="200">Grande</option>
                        </select>
                    </td>
                    <td><button onclick="addToCart(this)">Agregar</button></td>
                </tr>
                <tr>
                    <td>Pizza Pepperoni</td>
                    <td>Queso, tomate y pepperoni</td>
                    <td>
                        <select>
                            <option value="small" data-price="110">Pequeña</option>
                            <option value="medium" data-price="160">Mediana</option>
                            <option value="large" data-price="210">Grande</option>
                        </select>
                    </td>
                    <td><button onclick="addToCart(this)">Agregar</button></td>
                </tr>
            </tbody>
        </table>

        <h2 class="cart">Carrito de Compras</h2>
        <table id="cart">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Tamaño</th>
                    <th>Precio</th>
                    <th>Cantidad</th>
                    <th>Total</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <h3>Total a Pagar: $<span id="grandTotal">0</span></h3>
    </div>
    
    <script>
        function addToCart(button) {
            let row = button.parentElement.parentElement;
            let name = row.cells[0].textContent;
            let sizeSelect = row.cells[2].querySelector("select");
            let size = sizeSelect.options[sizeSelect.selectedIndex].text;
            let price = parseInt(sizeSelect.options[sizeSelect.selectedIndex].getAttribute("data-price"));
            
            let cartTable = document.getElementById("cart").getElementsByTagName("tbody")[0];
            let existingRow = [...cartTable.rows].find(r => r.cells[0].textContent === name && r.cells[1].textContent === size);
            
            if (existingRow) {
                let qtyCell = existingRow.cells[3].querySelector("input");
                qtyCell.value = parseInt(qtyCell.value) + 1;
                updateTotal(existingRow);
            } else {
                let newRow = cartTable.insertRow();
                newRow.insertCell(0).textContent = name;
                newRow.insertCell(1).textContent = size;
                newRow.insertCell(2).textContent = `$${price}`;
                let qtyCell = newRow.insertCell(3);
                let qtyInput = document.createElement("input");
                qtyInput.type = "number";
                qtyInput.value = 1;
                qtyInput.min = 1;
                qtyInput.onchange = function() { updateTotal(newRow); };
                qtyCell.appendChild(qtyInput);
                newRow.insertCell(4).textContent = `$${price}`;
                let deleteCell = newRow.insertCell(5);
                let deleteBtn = document.createElement("button");
                deleteBtn.textContent = "Eliminar";
                deleteBtn.onclick = function() { removeFromCart(newRow); };
                deleteCell.appendChild(deleteBtn);
                
                updateGrandTotal();
            }
        }

        function updateTotal(row) {
            let price = parseInt(row.cells[2].textContent.replace("$", ""));
            let qty = parseInt(row.cells[3].querySelector("input").value);
            row.cells[4].textContent = `$${price * qty}`;
            updateGrandTotal();
        }

        function removeFromCart(row) {
            row.parentElement.removeChild(row);
            updateGrandTotal();
        }

        function updateGrandTotal() {
            let total = 0;
            let cartRows = document.getElementById("cart").getElementsByTagName("tbody")[0].rows;
            for (let row of cartRows) {
                total += parseInt(row.cells[4].textContent.replace("$", ""));
            }
            document.getElementById("grandTotal").textContent = total;
        }
    </script>
</body>
</html>
